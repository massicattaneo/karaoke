<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Test load</title>
    <script src="../bower_components/core/build/core.min.js"></script>
    <script src="js/MidiEvent.js"></script>
    <script src="js/MidiFile.js"></script>
    <script src="js/Note.js"></script>
    <script src="js/StreamReader.js"></script>
    <script src="js/MidiEventStreamReader.js"></script>
    <script src="js/Audio.js"></script>
    <script src="js/Sampler.js"></script>
</head>
<body>
    <script>

        var library = packages.get('audio').library;
        var midiFile = packages.get('MidiFile');

        var loader = new Promises(2);
        loader.add(midiFile.load('../songsLibrary/minute_waltz.mid'));
        loader.add(library.load(['piano']));

        loader
            .imports('audio.play')
            .onDone(function (playAudio, midiFile, samplesLibrary) {
                console.log(midiFile.header);
                var playTime = 0;
                var pianoSamples = samplesLibrary.get('piano');
                var ticksPerBeat = midiFile.header.ticksPerBeat;

                midiFile.getTrack(2).getNotesOn().each(function (index, key, note) {
                    playTime = playTime + 0.18 + note.deltaTime / ticksPerBeat;
                    playAudio(pianoSamples.get(note.noteValue - 12), playTime, 11, note.velocity / 127);
                });

        });




    </script>
</body>
</html>